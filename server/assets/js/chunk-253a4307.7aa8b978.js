(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-253a4307"],{"260d":function(e,t,a){},"8a58":function(e,t,a){"use strict";a("68ef"),a("4d75")},9568:function(e,t,a){"use strict";var n=a("260d"),i=a.n(n);i.a},e41f:function(e,t,a){"use strict";var n=a("a142"),i=a("6605"),o=Object(n["i"])("popup"),r=o[0],s=o[1];t["a"]=r({mixins:[i["a"]],props:{position:String,transition:String,overlay:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0}},render:function(e){var t,a=this;if(this.shouldRender){var n=this.position,i=function(e){return function(){return a.$emit(e)}},o=this.transition||(n?"van-popup-slide-"+n:"van-fade");return e("transition",{attrs:{name:o},on:{afterEnter:i("opened"),afterLeave:i("closed")}},[e("div",{directives:[{name:"show",value:this.value}],class:s((t={},t[n]=n,t))},[this.slots()])])}}})},fb95:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"order-evaluate"},[e._l(e.evaluateForm,function(t,n){return a("div",{key:n,staticClass:"order-item"},[a("div",{staticClass:"evaluate-content"},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.getImg(t.thumb),expression:"getImg(item.thumb)"}]}),a("div",{staticClass:"goods-detail"},[a("h3",[e._v(e._s(t.goodsName))]),a("p",[e._v(e._s(t.colorName)+" /"+e._s(t.sizeName))])]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentMemo,expression:"item.commentMemo"}],staticClass:"evaluate-text",attrs:{rows:6,placeholder:"点击输入评价内容",maxlength:"150"},domProps:{value:t.commentMemo},on:{input:[function(a){a.target.composing||e.$set(t,"commentMemo",a.target.value)},e.forceUpdate]}}),a("upload-file",{model:{value:t.commentPictList,callback:function(a){e.$set(t,"commentPictList",a)},expression:"item.commentPictList"}})],1),a("div",{staticClass:"gray"})])}),a("div",{staticClass:"submit-btn",on:{click:e.submitEvaluate}},[e._v("提交")]),a("van-popup",{staticClass:"enlarge-detail",attrs:{overlay:!0},on:{click:function(t){e.showBigPic=!1}},model:{value:e.showBigPic,callback:function(t){e.showBigPic=t},expression:"showBigPic"}},[a("img",{attrs:{src:e.getImg(e.previewImg),onerror:"errImg(event)"},on:{click:function(t){e.showBigPic=!1}}})])],2)},i=[],o=(a("a481"),a("7f7f"),a("e7e5"),a("d399")),r=(a("ac6a"),a("96cf"),a("3b8d")),s=(a("8a58"),a("e41f")),c=(a("c3a6"),a("ad06")),u=a("22ce"),l=a("2b61"),m=a("c46c"),d={name:"order-evaluate",components:{"van-icon":c["a"],"van-popup":s["a"],uploadFile:m["a"]},data:function(){return{loading:!1,btnLock:!1,previewImg:null,evaluateForm:[],billCode:"",showBigPic:!1}},created:function(){this.billCode=this.$route.query.billCode,this.getEvaluateList()},mounted:function(){var e=this;setTimeout(function(){e.$nextTick(function(){window.scrollTo(0,1)})},0)},methods:{getEvaluateList:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,t={busContsCode:baseConstant.busContsCode,companyId:l["a"].get("COMPANYID").company_id,ownCompanyId:l["a"].get("COMPANYID").company_id,billCode:this.billCode},e.next=4,u["g"].getOrderEvaluateList(t).then(function(e){a.evaluateForm=e,a.loading=!1});case 4:this.evaluateForm.forEach(function(e){e.commentMemo="",e.commentPictList=[]}),this.forceUpdate();case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),beforeRead:function(e){if("image/png"==e.type||"image/jpeg"==e.type||"image/jpg"==e.type||"image/bmp"==e.type){var t=e.size/1024/1024<4;return!!t||(Object(o["a"])("图片过大，请更换一张或者进行压缩后上传"),!1)}return Object(o["a"])("上传图片必须是 JPG/PNG 格式!"),!1},afterRead:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t,a){var n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(5!==a.commentPictList.length){e.next=3;break}return Object(o["a"])("最多支持五张图片，请先删除再上传图片"),e.abrupt("return",!1);case 3:this.loading=!0,this.uploadImg(t.file,a).then(function(e){n.loading=!1,n.forceUpdate()});case 5:case"end":return e.stop()}},e,this)}));function t(t,a){return e.apply(this,arguments)}return t}(),uploadImg:function(e,t){return uploadImgDetail(e).then(function(a){var n=a.uploadDetail.successDetail;return t.commentPictList.push({fileLength:n.fileSize,md5:n.md5,fileUrl:n.filePath,fileNameSource:e.name,fileNameUpload:e.name,pictClass:"D_COMMENTPICT"}),!0})},submitEvaluate:function(){for(var e=this,t=0;t<this.evaluateForm.length;t++)if(0===this.evaluateForm[t].commentMemo.length&&0===this.evaluateForm[t].commentPictList.length)return Object(o["a"])("请将评价填写完整再提交"),!1;var a={billCode:this.billCode,busContsCode:baseConstant.busContsCode};u["g"].getDetailInfo(a).then(function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(a){var n,i,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1!==a.data.reviewFlag){t.next=5;break}return Object(o["a"])("该订单已存在追评"),t.abrupt("return",!1);case 5:if(e.btnLock){t.next=20;break}e.loading=!0,e.btnLock=!0,n=[],i=0;case 10:if(!(i<e.evaluateForm.length)){t.next=18;break}return t.next=13,e.formatPictList(e.evaluateForm[i].commentPictList);case 13:e.evaluateForm[i].commentPictList=t.sent,n.push({spCommentHdId:e.evaluateForm[i].spCommentDtDto.spCommentHdId,upSpCommentDtId:e.evaluateForm[i].spCommentDtDto.id,showFlag:1,commentMemo:e.evaluateForm[i].commentMemo,fileDtSaveDtos:e.evaluateForm[i].commentPictList});case 15:i++,t.next=10;break;case 18:r={companyId:l["a"].get("COMPANYID").company_id,ownCompanyId:l["a"].get("COMPANYID").company_id,usrId:l["a"].get("USER_INFO").usrId,vipInfoHdId:l["a"].get("USER_INFO").vipInfoId,spCommentDtSaveDtos:n},u["g"].ordAddComment(r).then(function(t){1===t&&(e.loading=!1,e.btnLock=!1,Object(o["a"])("提交成功"),e.$router.go(-1))});case 20:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())},formatPictList:function(e){if(!e||0==e.length)return[];var t=JSON.stringify(e);return t=t.replace(/sourceFileName/g,"fileNameSource"),t=t.replace(/pictPath/g,"fileUrl"),e=JSON.parse(t),e.forEach(function(e){e.fileNameUpload=e.fileNameSource}),e},showPreviewDialog:function(e){this.showBigPic=!0,this.previewImg=e},removePreview:function(e,t){e.commentPictList.splice(t,1),this.forceUpdate()},forceUpdate:function(){this.$forceUpdate()}}},p=d,f=(a("9568"),a("2877")),v=Object(f["a"])(p,n,i,!1,null,"9a344e92",null);t["default"]=v.exports}}]);