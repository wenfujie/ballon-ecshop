(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-563ff2aa"],{"28c3":function(e,t,n){"use strict";(function(e){n("96cf");var o=n("3b8d"),a=(n("28a5"),n("386d"),n("a481"),n("ac1e"),n("543e")),i=(n("8a58"),n("e41f")),r=n("22ce"),s=n("2b61"),c=n("d94e");t["a"]={components:{"van-popup":i["a"],"van-loading":a["a"]},data:function(){return{userInfo:{},loading:!0,timeStap:(new Date).getTime()}},methods:{wechatUserLogin:function(){var e={wxUUID:s["a"].get("properties").wxUnionid,redirectUri:baseConstant.redirectUri,scope:2};this.$route.query.checkLogin&&(console.log("静默登陆"),e.redirectUri=baseConstant.redirectUri+"&checkLogin=true"),r["f"].wechatLogin(e).then(function(e){window.location.replace(e.url)},function(e){alert("page-login-err"+e)})},getWechatInfo:function(){var e=this,t=window.location.search.substr(1)||window.location.hash.split("?")[1];if(t){var n=getQueryVariable(t,"code");if(c["a"].get("LOGINCODE")){var o=c["a"].get("LOGINCODE").loginCode;n===o&&(c["a"].remove("LOGINCODE"),this.$router.replace("/login"))}else{var a={code:n,wxUUID:s["a"].get("properties").wxUnionid};r["f"].wechatInfo(a).then(function(t){t.wxResp&&-1!==t.success?(e.userLogin(t.wxResp),s["a"].set("Wechat_info",t.wxResp),c["a"].set("ISLOGIN",{isLogin:!0}),c["a"].set("LOGINCODE",{loginCode:n})):window.location.replace(baseConstant.redirectUri)},function(e){alert("page-member-center-微信登陆"+e)})}}},userLogin:function(t){var n=this;s["a"].set("WECHAT_INFO",t);var a="";1==t.sex?a="D_MALE":2==t.sex&&(a="D_FEMALE");var i={companyId:s["a"].get("COMPANYID").company_id,shopId:s["a"].get("properties").shopId,busContsCode:e.baseConstant.busContsCode,unionId:t.unionid,openId:t.openid,signUpTypeCode:baseConstant.signUpTypeCode,usrName:t.nickname,url:t.headimgurl,sex:a};r["f"].userInfo(i).then(function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log(t.usrId),e.next=3,n.getUserDetailInfo(t.vipInfoId);case 3:o=e.sent,t.mobilePhone=o.mobilePhone,t.cardNo,o.cardNo,s["a"].set("USER_INFO",t),s["a"].set("CARDNO",{cardNo:o.cardNo}),o.usrId&&o.mobilePhone&&r["m"].sendCardCoupons({usrId:t.usrId||"",shopId:s["a"].get("properties").shopId,vipInfoHdId:t.vipInfoHdId||""});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),function(e){alert("page-member-center-联合登陆"+e)}).then(function(){n.getDefaultTemplate()})},login:function(){var e="",t="";try{e=window.location.search.substr(1)||window.location.hash.split("?")[1]}catch(n){}try{t=getQueryVariable(e,"code")}catch(n){}console.log("code",t),t?this.getWechatInfo():this.wechatUserLogin()},getDefaultTemplate:function(){var e=this,t={busContsCode:baseConstant.busContsCode};r["b"].getUsrCmsTemplate(t).then(function(e){s["a"].set("TEMPLATE_INFO",e[0])}).then(function(){if(s["a"].get("USER_INFO")&&c["a"].get("ISLOGIN")){var t=s["a"].get("redirectPath");t?(s["a"].remove("redirectPath"),-1===decodeURIComponent(t.path).indexOf("login")?e.$router.replace(decodeURIComponent(t.path)):e.$router.replace("/index")):e.$router.replace("/index")}else e.login()})},getUserDetailInfo:function(e){return r["k"].getUserInfo({vipInfoHdId:e}).then(function(e){return e})}},created:function(){var e=this,t=window.location.href;-1!=t.indexOf("path")&&s["a"].set("redirectPath",{path:t.split("path=")[1]}),getBaseParams().then(function(t){t?e.getDefaultTemplate():e.loading=!1})},watch:{$route:function(e,t){this.timeStap=(new Date).getTime()}}}}).call(this,n("c8ba"))},"386d":function(e,t,n){n("214f")("search",1,function(e,t,n){return[function(n){"use strict";var o=e(this),a=void 0==n?void 0:n[t];return void 0!==a?a.call(n,o):new RegExp(n)[t](String(o))},n]})},"8a58":function(e,t,n){"use strict";n("68ef"),n("4d75")},a86a:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{key:e.timeStap,staticClass:"login"},[n("van-popup",{model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[n("van-loading",{attrs:{color:"white"}})],1)],1)},a=[],i=n("28c3"),r=i["a"],s=n("2877"),c=Object(s["a"])(r,o,a,!1,null,null,null);t["default"]=c.exports},ac1e:function(e,t,n){"use strict";n("68ef")},e41f:function(e,t,n){"use strict";var o=n("a142"),a=n("6605"),i=Object(o["i"])("popup"),r=i[0],s=i[1];t["a"]=r({mixins:[a["a"]],props:{position:String,transition:String,overlay:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0}},render:function(e){var t,n=this;if(this.shouldRender){var o=this.position,a=function(e){return function(){return n.$emit(e)}},i=this.transition||(o?"van-popup-slide-"+o:"van-fade");return e("transition",{attrs:{name:i},on:{afterEnter:a("opened"),afterLeave:a("closed")}},[e("div",{directives:[{name:"show",value:this.value}],class:s((t={},t[o]=o,t))},[this.slots()])])}}})}}]);